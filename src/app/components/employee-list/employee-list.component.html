<div class="flex flex-col gap-4 p-6">
    <div class="text-xl">Employee List</div>

    <div>
        <mat-form-field class="w-full" appearance="outline">
            <input type="text" matInput placeholder="Search by name..." [formControl]="keyword">
            <button mat-icon-button matSuffix class="m-2" (click)="resetKeyword(true)">
                <mat-icon class="cursor-pointer">close</mat-icon>  
            </button>
        </mat-form-field>
        <div class="flex items-center gap-2">
            <span class="font-light">Filter By Group :</span>
            <mat-slide-toggle [formControl]="showGroupFilter" (change)="onToggleChange()"></mat-slide-toggle>
        </div>
        <div class="grid grid-cols-5" *ngIf="showGroupFilter?.value">
            <div *ngFor="let group of groupFilter | keyvalue">
                <mat-checkbox
                    [checked]="group.value"
                    (change)="onCheckboxChange($event, group.key)">
                </mat-checkbox>
                {{ group.key }}
            </div>
        </div>
    </div>

    <div class="bg-gray-100 flex justify-between">
        <button type="button" (click)="onClickAdd()" mat-button>
            <mat-icon>add</mat-icon>
            Add New Employee
        </button>
        <button type="button" (click)="onClickRefresh()" mat-button>
            <mat-icon>refresh</mat-icon>
            Refresh
        </button>
    </div>

    <div class="overflow-x-auto">
        @if (isLoading) {
        <div class="flex w-full h-screen justify-center items-center">
            <mat-spinner></mat-spinner>
        </div>
        } @else { 
        <table mat-table [dataSource]="dataSource" matSort (matSortChange)="onSortChange()">
            <ng-container *matNoDataRow>
                <td class="text-center" [attr.colspan]="displayedColumns.length">
                    No data to display.
                </td>
            </ng-container>

            <ng-container matColumnDef="action" sticky>
                <th mat-header-cell *matHeaderCellDef class="text-center">Actions</th>
                <td mat-cell *matCellDef="let item" class="flex flex-row text-center gap-2 !py-2">
                    <button mat-flat-button (click)="onClickDetail(item)">Detail</button>
                    <button mat-flat-button class="!bg-yellow-500">Edit</button>
                    <button mat-flat-button class="!bg-red-600">Delete</button>
                </td>
            </ng-container>

            @for (column of displayedColumns; track column) {
            @if (column !== 'action') {
            <ng-container [matColumnDef]="column">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <div class="inline-flex flex-col gap-2">
                        <div class="inline-block whitespace-nowrap">
                            {{ columnObj[column]?.display }}
                        </div>
                    </div>
                </th>
                <td mat-cell *matCellDef="let element">
                    @if (column === 'fullName') {
                        {{ element['firstName'] }} {{ element['lastName'] }}
                    } @else if (columnObj[column]?.type === 'date') {
                        {{ element[column] | date: 'dd MMM yyyy'}}
                    } @else {
                        {{ element[column] || 'N/A' }}
                    }
                </td>
            </ng-container>
            }
            }
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        }
    </div>
    
    <mat-paginator [length]="totalItems" [pageSize]="itemsPerPage" [pageSizeOptions]="[5, 10, 25, 50]"
        (page)="onPageChange($event)" class="mt-4" showFirstLastButtons>
    </mat-paginator>
</div>